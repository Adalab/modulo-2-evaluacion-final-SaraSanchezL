"use strict";const btnSearch=document.querySelector(".js-btnSearch"),btnReset=document.querySelector(".js-btnReset"),listResults=document.querySelector(".js-list"),inputSearch=document.querySelector(".js-inputSearch"),listFavourites=document.querySelector(".js-listFavourites"),btnDeleteAllFav=document.querySelector(".js-btnDeleteAll"),textError=document.querySelector(".js-textError"),form=document.querySelector(".js-form");let listSeriesArr=[],listFavouriteArr=[];function getDataSeries(){fetch("https://api.jikan.moe/v3/search/anime?q="+inputSearch.value).then(e=>e.json()).then(e=>{const t=e.results,r=t.map(e=>({id:e.mal_id,title:e.title,img:e.image_url,airing:e.airing,url:e.url}));listSeriesArr=r,listResults.innerHTML="";for(let e=0;e<listSeriesArr.length;e++)!1===t[e].airing?listResults.innerHTML+=`<li class="js-li colorLi" id="${listSeriesArr[e].id}" data-id="${listSeriesArr[e].id}"> <img class="js-img cursorSelectFav" title="Marcar / Desmarcar Favorita" src="${listSeriesArr[e].img}" alt="Serie Image"><p class="cursorSelectFav" title="Marcar / Desmarcar Favorita">${listSeriesArr[e].title}</p> <p> ${listSeriesArr[e].airing} : No se está transmitiendo. </p> </li>`:listResults.innerHTML+=`<li class="js-li colorLi" id="${listSeriesArr[e].id}" data-id="${listSeriesArr[e].id}"> <img class="js-img cursorSelectFav" title="Marcar / Desmarcar Favorita" src="${listSeriesArr[e].img}" alt="Serie Image"><p class="cursorSelectFav" title="Marcar / Desmarcar Favorita">${listSeriesArr[e].title}</p> <p> ${listSeriesArr[e].airing} : Se está transmitiendo. Click para ver más detalle.</p></li> <li><a class="link" href="${listSeriesArr[e].url}">Más detalles</a></li>`;const i=document.querySelectorAll(".js-li");for(const e of i)e.addEventListener("click",handleClickRenderListFav);for(const e of listFavouriteArr){const t=e.malId;for(const e of i){parseInt(e.id)===t&&e.classList.add("favourite")}}})}function handleClickRenderListFav(e){e.preventDefault();const t=parseInt(e.currentTarget.dataset.id);for(const r of listSeriesArr){let i={malId:r.id,url:r.url,imageUrl:r.img,title:r.title,airing:r.airing};if(t===r.id){listFavourites.innerHTML="";const r=listFavouriteArr.findIndex(e=>e.malId===t);-1===r?(e.currentTarget.classList.add("favourite"),listFavouriteArr.push(i),localStorage.setItem("Fav",JSON.stringify(listFavouriteArr))):(e.currentTarget.classList.remove("favourite"),listFavouriteArr.splice(r,1),localStorage.setItem("Fav",JSON.stringify(listFavouriteArr))),renderFavHTML()}}const r=document.querySelectorAll(".js-btnX");for(const e of r)e.addEventListener("click",handleClickDeleteOne);const i=document.querySelectorAll(".js-liFav");for(const e of i)e.addEventListener("click",handleClickListFav)}function handleClickListFav(e){const t=parseInt(e.currentTarget.dataset.id);listFavouriteArr.find(e=>e.malId===t)}function renderFavHTML(){for(const e of listFavouriteArr)listFavourites.innerHTML+=`<li class="js-liFav colorLi" data-id="${e.malId}"> <img class="js-img" src="${e.imageUrl}" alt="Serie Image"> <p>${e.title}</p><button class="js-btnX colorBtnX" title="Pulse para borrar de la lista" id="${e.malId}">X</button></li>`}function useLocalFav(){const e=JSON.parse(localStorage.getItem("Fav"));if(null===e)listFavourites.innerHTML="";else for(const t of e)listFavourites.innerHTML+=`<li class="js-li colorLi" data-id="${t.malId}"> <img class="js-img" src="${t.imageUrl}" alt="Serie Image"> <p>${t.title}</p><button class="js-btnX colorBtnX" title="Pulse para borrar de la lista" id="${t.malId}">X</button></li>`,listFavouriteArr.push(t)}useLocalFav();const allBtnX=document.querySelectorAll(".js-btnX");for(const e of allBtnX)e.addEventListener("click",handleClickDeleteOne);function handleClickDeleteOne(e){e.preventDefault();const t=e.currentTarget.id;listFavourites.innerHTML="";const r=document.querySelectorAll(".js-li");for(const e of r){e.id===t&&e.classList.remove("favourite")}const i=listFavouriteArr.findIndex(e=>e.malId===parseInt(t));listFavouriteArr.splice(i,1),localStorage.setItem("Fav",JSON.stringify(listFavouriteArr)),renderFavHTML();const l=document.querySelectorAll(".js-btnX");for(const e of l)e.addEventListener("click",handleClickDeleteOne)}function handleDeleteAllFav(e){e.preventDefault(),listFavourites.innerHTML="",localStorage.removeItem("Fav"),listFavouriteArr=[];const t=document.querySelectorAll(".js-li");for(const e of t){const t=e.id;-1===listFavouriteArr.findIndex(e=>e.malId===t)&&e.classList.remove("favourite")}}function handleInputSearch(){""===inputSearch.value?(textError.innerHTML="Campo de búsqueda vacío",btnSearch.setAttribute("disabled","disabled")):(textError.innerHTML="",btnSearch.removeAttribute("disabled"))}function handleClickSearch(e){e.preventDefault(),getDataSeries()}function handleClickReset(e){e.preventDefault(),listResults.innerHTML="",inputSearch.value="",handleInputSearch(),textError.innerHTML=""}btnDeleteAllFav.addEventListener("click",handleDeleteAllFav),inputSearch.addEventListener("keyup",handleInputSearch),btnSearch.addEventListener("click",handleClickSearch),btnReset.addEventListener("click",handleClickReset);const handleForm=e=>{13===e.keyCode&&e.preventDefault()};form.addEventListener("keypress",handleForm);