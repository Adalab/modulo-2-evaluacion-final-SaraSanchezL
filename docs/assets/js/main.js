"use strict";const btnSearch=document.querySelector(".js-btnSearch"),btnReset=document.querySelector(".js-btnReset"),listResults=document.querySelector(".js-list"),inputSearch=document.querySelector(".js-inputSearch"),listFavourites=document.querySelector(".js-listFavourites"),btnDeleteAllFav=document.querySelector(".js-btnDeleteAll"),textError=document.querySelector(".js-textError");let listSeriesArr=[],listFavouriteArr=[];function getDataSeries(){fetch("https://api.jikan.moe/v3/search/anime?q="+inputSearch.value).then(e=>e.json()).then(e=>{const t=e.results;listSeriesArr=t,listResults.innerHTML="";for(let e=0;e<t.length;e++){const r=t[e].image_url;null===r&&(r.innerHTML="https://via.placeholder.com/210x295/ffffff/666666/?\n          text="+inputSearch.value),listResults.innerHTML+=`<li class="js-li" id="${t[e].mal_id}" data-id="${t[e].mal_id}"> <img class="js-img cursorSelectFav" src="${t[e].image_url}" alt="Serie Image"><p class="cursorSelectFav">${t[e].title}</p></li>`}function r(e){e.preventDefault();const t=parseInt(e.currentTarget.dataset.id);for(const r of listSeriesArr){let l={malId:r.mal_id,url:r.url,imageUrl:r.image_url,title:r.title,airing:r.airing,synopsis:r.synopsis,type:r.type,episodes:r.episodes,score:r.score,startDate:r.start_date,endDate:r.end_date,members:r.members,rated:r.rated};if(t===r.mal_id){listFavourites.innerHTML="",e.currentTarget.classList.toggle("favourite");const r=listFavouriteArr.findIndex(e=>e.mal_id===t);-1===r?(listFavouriteArr.push(l),localStorage.setItem("Fav",JSON.stringify(listFavouriteArr))):(listFavouriteArr.splice(r,1),localStorage.setItem("Fav",JSON.stringify(listFavouriteArr)));for(const e of listFavouriteArr)listFavourites.innerHTML+=`<li class="js-li" data-id="${e.mal_id}"> <img class="js-img" src="${e.image_url}" alt="Serie Image"> <p>${e.title}</p><button class="js-btnX colorBtnX" id="${e.mal_id}">X</button></li>`}}const r=document.querySelectorAll(".js-btnX");for(const e of r)e.addEventListener("click",handleClickDeleteOne)}const l=document.querySelectorAll(".js-li");for(const e of l)e.addEventListener("click",r);for(const e of listFavouriteArr){const t=e.mal_id;for(const e of l){parseInt(e.id)===t&&e.classList.add("favourite")}}})}function useLocalFav(){const e=JSON.parse(localStorage.getItem("Fav"));if(null===e)listFavourites.innerHTML="";else for(const t of e)listFavourites.innerHTML+=`<li class="js-li" data-id="${t.mal_id}"> <img class="js-img" src="${t.image_url}" alt="Serie Image"> <p>${t.title}</p><button class="js-btnX colorBtnX" id="${t.mal_id}">X</button></li>`,listFavouriteArr.push(t)}useLocalFav();const allBtnX=document.querySelectorAll(".js-btnX");for(const e of allBtnX)e.addEventListener("click",handleClickDeleteOne);function handleClickDeleteOne(e){const t=e.currentTarget.id;listFavourites.innerHTML="";const r=listFavouriteArr.findIndex(e=>e.mal_id===parseInt(t));listFavouriteArr.splice(r,1),localStorage.setItem("Fav",JSON.stringify(listFavouriteArr));for(const e of listFavouriteArr){listFavourites.innerHTML+=`<li class="js-li" data-id="${e.mal_id}"> <img class="js-img" src="${e.image_url}" alt="Serie Image"> <p>${e.title}</p><button class="js-btnX colorBtnX" id="${e.mal_id}">X</button></li>`;const t=document.querySelectorAll(".js-btnX");for(const e of t)e.addEventListener("click",handleClickDeleteOne)}}function handleDeleteAllFav(e){e.preventDefault(),listFavourites.innerHTML="",localStorage.removeItem("Fav"),listFavouriteArr=[]}function handleInputSearch(){""===inputSearch.value?(textError.innerHTML="Campo de búsqueda vacío",btnSearch.setAttribute("disabled","disabled")):(textError.innerHTML="",btnSearch.removeAttribute("disabled"))}function handleClickSearch(e){e.preventDefault(),getDataSeries()}function handleClickReset(e){e.preventDefault(),listResults.innerHTML="",inputSearch.value="",textError.innerHTML="",handleInputSearch()}btnDeleteAllFav.addEventListener("click",handleDeleteAllFav),inputSearch.addEventListener("keyup",handleInputSearch),btnSearch.addEventListener("click",handleClickSearch),btnReset.addEventListener("click",handleClickReset);